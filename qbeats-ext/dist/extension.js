(()=>{"use strict";var e={112:function(e,t,i){var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var o=Object.getOwnPropertyDescriptor(t,i);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,o)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&n(t,e,i);return o(t,e),t},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.deactivate=t.activate=void 0;const s=r(i(496)),c=r(i(147)),d=a(i(17));let u;const l=s.languages.createDiagnosticCollection("QuoicouBeats");async function m(){const e=s.window.activeTextEditor;if(e){const t=function(e){const t=[],i=["Tempo","TimeSignature","Ticks"];for(const n of i)if(!new RegExp(`\\b${n}\\b`,"g").test(e)){const i=e.indexOf("Tracks"),o=s.window.activeTextEditor?.document.positionAt(0),r=s.window.activeTextEditor?.document.positionAt(i),a=new s.Range(o,r),c=new s.Diagnostic(a,`Le mot-clé ${n} est manquant.`,s.DiagnosticSeverity.Error);t.push(c)}const n=e.match(/Track\s*"[^"]*"\s*\{[^}]*\}/g)||[];for(const i of n)if(!i.includes("Instrument")){const n=e.indexOf(i),o=n+i.indexOf("}"),r=s.window.activeTextEditor?.document.positionAt(n),a=s.window.activeTextEditor?.document.positionAt(o),c=new s.Range(r,a),d=new s.Diagnostic(c,"Le mot-clé Instrument est manquant dans le bloc Track.",s.DiagnosticSeverity.Error);t.push(d)}if(!e.match(/TimeSignature\s*(\d+\/\d+)/)){const i=e.indexOf("TimeSignature"),n=s.window.activeTextEditor?.document.positionAt(i),o=s.window.activeTextEditor?.document.positionAt(i+13),r=new s.Range(n,o),a=new s.Diagnostic(r,"La signature temporelle après TimeSignature est manquante ou invalide.",s.DiagnosticSeverity.Error);t.push(a)}const o=e.match(/Tempo\s*(\d+)/),r=e.match(/Ticks\s*(\d+)/);if(!o||isNaN(Number(o[1]))){const i=e.indexOf("Tempo"),n=s.window.activeTextEditor?.document.positionAt(i),o=s.window.activeTextEditor?.document.positionAt(i+5),r=new s.Range(n,o),a=new s.Diagnostic(r,"La valeur de Tempo n'est pas un nombre valide.",s.DiagnosticSeverity.Error);t.push(a)}if(!r||isNaN(Number(r[1]))){const i=e.indexOf("Ticks"),n=s.window.activeTextEditor?.document.positionAt(i),o=s.window.activeTextEditor?.document.positionAt(i+5),r=new s.Range(n,o),a=new s.Diagnostic(r,"La valeur de Ticks n'est pas un nombre valide.",s.DiagnosticSeverity.Error);t.push(a)}return t}(e.document.getText());t.length>0?function(e,t){u&&u.dispose(),u=s.window.createTextEditorDecorationType({textDecoration:"underline wavy red"});const i=t.map((e=>e.range));e.setDecorations(u,i),l.set(e.document.uri,t)}(e,t):(u&&u.dispose(),l.clear())}}t.activate=function(e){let t=s.commands.registerCommand("extension.analyzeCode",(()=>{m()})),i=s.workspace.onDidChangeTextDocument((e=>{e.document===s.window.activeTextEditor?.document&&"qb"===e.document.languageId&&m()}));s.commands.registerCommand("extension.openKeyboardHtml",(()=>{const e=s.window.activeTextEditor;e&&function(e){const t=s.window.createWebviewPanel("htmlPreview","Aperçu HTML",s.ViewColumn.One,{enableScripts:!0,localResourceRoots:[s.Uri.file(d.default.dirname(e))]});let i=c.readFileSync(e,"utf8");const n=d.default.join(d.default.dirname(e),"assets/"),o=t.webview.asWebviewUri(s.Uri.file(n));i=i.replace(/assets\//g,o.toString()),t.webview.html=i}(`${e.document.fileName.replace("scenarios","generated").split(".")[0]}-wk.html`)})),e.subscriptions.push(t,i)},t.deactivate=function(){}},496:e=>{e.exports=require("vscode")},147:e=>{e.exports=require("fs")},17:e=>{e.exports=require("path")}},t={},i=function i(n){var o=t[n];if(void 0!==o)return o.exports;var r=t[n]={exports:{}};return e[n].call(r.exports,r,r.exports,i),r.exports}(112);module.exports=i})();